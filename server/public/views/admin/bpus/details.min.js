var doPrint=!0,myPrint=function(a){doPrint&&console.log("(public/admin/bpus/details.js)	"+a)};!function(){"use strict";app=app||{},app.Bpu=Backbone.Model.extend({idAttribute:"_id",url:function(){return"/admin/bpus/"+this.id+"/"}}),app.Delete=Backbone.Model.extend({idAttribute:"_id",defaults:{success:!1,errors:[],errfor:{}},url:function(){return"/admin/bpus/"+app.mainView.model.id+"/"}}),app.Details=Backbone.Model.extend({idAttribute:"_id",defaults:{success:!1,errors:[],errfor:{},name:"",index:-1,isOn:!1,allowedGroups:[],localAddr:{ip:"",serverPort:"",webcamPort:""},publicAddr:{ip:"",serverPort:"",webcamPort:""},currentStatus:{},magnification:"",notes:[]},url:function(){return"/admin/bpus/"+app.mainView.model.id+"/"},parse:function(a){return a.account&&(app.mainView.model.set(a.account),delete a.account),a}}),app.Note=Backbone.Model.extend({idAttribute:"_id",defaults:{success:!1,errors:[],data:"",userCreated:{}},url:function(){return"/admin/bpus/"+app.mainView.model.id+"/notes/"+(this.isNew()?"":this.id+"/")},parse:function(a){return a.account&&(app.mainView.model.set(a.account),delete a.account),a}}),app.NoteCollection=Backbone.Collection.extend({model:app.Note}),app.DetailsView=Backbone.View.extend({el:"#details",template:_.template($("#tmpl-details").html()),events:{},initialize:function(){this.model=new app.Details,this.syncUp(),this.listenTo(app.mainView.model,"change",this.syncUp),this.listenTo(this.model,"sync",this.render),this.render()},syncUp:function(){this.model.set({_id:app.mainView.model.id,name:app.mainView.model.get("name"),index:app.mainView.model.get("index"),isOn:app.mainView.model.get("isOn"),magnification:app.mainView.model.get("magnification"),allowedGroups:app.mainView.model.get("allowedGroups"),currentStatus:app.mainView.model.get("currentStatus"),notes:app.mainView.model.get("notes"),localAddr:app.mainView.model.get("localAddr"),publicAddr:app.mainView.model.get("publicAddr")})},render:function(){this.$el.html(this.template(this.model.attributes));for(var a in this.model.attributes)this.model.attributes.hasOwnProperty(a)&&this.$el.find('[name="'+a+'"]').val(this.model.attributes[a])}}),app.NewNoteView=Backbone.View.extend({el:"#notes-new",template:_.template($("#tmpl-notes-new").html()),events:{"click .btn-add":"addNew"},initialize:function(){this.model=new app.Note,this.listenTo(this.model,"change",this.render),this.render()},render:function(){this.$el.html(this.template(this.model.attributes))},validates:function(){var a=[];return""===this.$el.find('[name="data"]').val()&&a.push("Please enter some notes."),a.length>0?(this.model.set({errors:a}),!1):!0},addNew:function(){this.validates()&&this.model.save({data:this.$el.find('[name="data"]').val()})}}),app.NoteCollectionView=Backbone.View.extend({el:"#notes-collection",template:_.template($("#tmpl-notes-collection").html()),initialize:function(){this.collection=new app.NoteCollection,this.syncUp(),this.listenTo(app.mainView.model,"change",this.syncUp),this.listenTo(this.collection,"reset",this.render),this.render()},syncUp:function(){this.collection.reset(app.mainView.model.get("notes"))},render:function(){this.$el.html(this.template());var a=document.createDocumentFragment(),b=document.createTextNode("");a.appendChild(b),this.collection.each(function(c){var d=new Date(c.attributes.userCreated.time);c.attributes.userCreated.time=d.toLocaleString();var e=new app.NotesItemView({model:c}),f=e.render().el;a.insertBefore(f,b),b=f},this),$("#notes-items").append(a),0===this.collection.length&&$("#notes-items").append($("#tmpl-notes-none").html())}}),app.NotesItemView=Backbone.View.extend({tagName:"div",className:"note",template:_.template($("#tmpl-notes-item").html()),render:function(){return this.$el.html(this.template(this.model.attributes)),this.$el.find(".timeago").each(function(a,b){if(b.innerText){var c=moment(b.innerText);b.innerText=c.from()}}),this}}),app.HeaderView=Backbone.View.extend({el:"#header",template:_.template($("#tmpl-header").html()),initialize:function(){this.model=app.mainView.model,this.listenTo(this.model,"change",this.render),this.render()},render:function(){this.$el.html(this.template(this.model.attributes))},setDateLabel:function(){var a=this.$el.find('[name="dateLabel"]')[0];a&&(a.innerHTML="Last Update: "+(new Date).toLocaleString())},setStatusLabel:function(a){var b=this.$el.find('[name="statusLabel"]')[0];b&&(b.innerHTML="Status: "+a)},setErrorLabel:function(a){var b=this.$el.find('[name="errorLabel"]')[0];b&&(b.innerHTML="Error: "+a)}}),app.MainView=Backbone.View.extend({el:".page .container",isSocketConnected:!1,updateBpusCallback:function(a){app.headerView.setDateLabel(),null!==a.err&&void 0!==a.err?app.headerView.setErrorLabel(a.err):app.headerView.setErrorLabel("None"),app.headerView.setStatusLabel("bpuStatus="+a.bpuStatus+", username="+a.username+", runTime="+a.timeLeft+", timeLeft="+a.timeLeft+", processingTime="+a.processingTimePerExperiment),null===a.bpuStatus||void 0===a.bpuStatus?app.liveView.disableButtons(!0):"bpuNull"===a.bpuStatus?app.liveView.disableButtons(!1):app.liveView.disableButtons(!0)},initialUpdate:function(a,b){if(app.mainView.isSocketConnected=a.didPass,app.headerView.setDateLabel(),null!==a.err&&app.headerView.setErrorLabel(a.err),a.didPass){var c=a.bpuStatus.bpuStatus;"bpuNull"===c?app.liveView.disableButtons(!1):app.liveView.disableButtons(!0),app.graphView.disableButtons(!1),app.headerView.setStatusLabel("bpuStatus="+c+", username="+a.bpuStatus.username+", runTime="+a.bpuStatus.timeLeft+", timeLeft="+a.bpuStatus.timeLeft+", processingTime="+a.bpuStatus.processingTimePerExperiment)}else app.liveView.disableButtons(!0),app.graphView.disableButtons(!0),app.headerView.setStatusLabel("Did Not Pass(didFindBpu="+a.didFindBpu+", didFindBpuSocket="+a.didFindBpuSocket+", didGetBpuStatus="+a.didFindBpuSocket+")");b.forEach(function(a){app.graphView.updateLabelsWithGraphRefresh(a)})},initialize:function(){app.mainView=this,app.mainView.model=new app.Bpu(JSON.parse(unescape($("#data-record").html()))),app.headerView=new app.HeaderView,app.detailsView=new app.DetailsView,app.newNoteView=new app.NewNoteView,app.notesCollectionView=new app.NoteCollectionView,app.liveView=new app.LiveView,app.graphView=new app.GraphView,app.mainView.isSocketConnected=!1,app.mainView.socketOptions={id:app.mainView.model.id,bpuName:app.mainView.model.get("name"),bpuIndex:app.mainView.model.get("index"),localAddr:app.mainView.model.get("localAddr"),timeoutInterval:1e4},app.socketClient.setConnection(app.mainView.socketOptions,function(a,b){var c=["activity","population","response"];if(app.mainView.model.get("avgStatsData").length<c.length){var d=function(){if(c.length>0){var a=c.shift(),e={bpuName:app.mainView.socketOptions.bpuName,scriptType:a,filter:{count:1,type:"all"}};app.graphView.refreshData(e,function(a,b){a&&myPrint("Init Error app.graphView.refreshData err:"+a),d()})}else app.mainView.initialUpdate(b,app.mainView.model.get("plotData")),app.socketClient.startUpdateBpus(app.mainView.updateBpusCallback)};d()}else app.mainView.initialUpdate(b,app.mainView.model.get("plotData")),app.socketClient.startUpdateBpus(app.mainView.updateBpusCallback)})}}),$(document).ready(function(){app.mainView=new app.MainView})}();
//# sourceMappingURL=details.min.js.map