!function(){"use strict";app=app||{},app.Session=Backbone.Model.extend({idAttribute:"_id",url:"/goLabz/"}),app.User=Backbone.Model.extend({idAttribute:"_id",url:"/goLabz/"}),app.LiveJoin=Backbone.Model.extend({idAttribute:"_id",url:"/goLabz/"}),app.MainView=Backbone.View.extend({el:".page .container",didPassCanceling:!1,isSocketInitialized:!1,hasAcceptedLiveExp:!1,lastBpuUpdateObj:null,wasUpdateUIsCalled:!1,bpuIndicies:[],roundMsToMins:function(a){return Math.floor(a/6e4)},roundMsToSeconds:function(a){return Math.round(a/1e3)},userExpInfo:{isSubmitting:!1,liveExp:{maxActive:1,activeExps:null,maxTime:3e5,timeToFinish:null,canSubmit:function(a,b){return a&&(console.log(b+" liveExp.activeExps="+app.mainView.userExpInfo.liveExp.activeExps,null!==app.mainView.userExpInfo.liveExp.activeExps),console.log(b+" liveExp.timeToFinish="+app.mainView.userExpInfo.liveExp.timeToFinish,null!==app.mainView.userExpInfo.liveExp.timeToFinish),console.log(b+" isSubmitting="+app.mainView.userExpInfo.isSubmitting,!app.mainView.userExpInfo.isSubmitting),console.log(b+" isSubmitting="+app.mainView.userExpInfo.isSubmitting,!app.mainView.userExpInfo.isSubmitting),console.log(b+" liveExp.activeExps<liveExp.maxActive="+app.mainView.userExpInfo.liveExp.activeExps+"<"+app.mainView.userExpInfo.liveExp.maxActive,app.mainView.userExpInfo.liveExp.activeExps<app.mainView.userExpInfo.liveExp.maxActive),console.log(b+" liveExp.timeToFinish<liveExp.maxTime="+app.mainView.userExpInfo.liveExp.timeToFinish+"<"+app.mainView.userExpInfo.liveExp.maxTime,app.mainView.userExpInfo.liveExp.timeToFinish<app.mainView.userExpInfo.liveExp.maxTime)),null!==app.mainView.userExpInfo.liveExp.activeExps&&null!==app.mainView.userExpInfo.liveExp.timeToFinish?!app.mainView.userExpInfo.isSubmitting&&app.mainView.userExpInfo.liveExp.activeExps<app.mainView.userExpInfo.liveExp.maxActive&&app.mainView.userExpInfo.liveExp.timeToFinish<app.mainView.userExpInfo.liveExp.maxTime:!1}}},submitExperimentFromViews:function(a,b,c){if(app.mainView.disableUI("app.mainView.submitExperimentFromViews"),app.mainView.isSocketInitialized)if(app.mainView.userExpInfo.isSubmitting)c("app.mainView.userExpInfo.isSubmitting");else{app.mainView.userExpInfo.isSubmitting=!0;var d=[],e=!1,f=!1;if("live"===a){e=!0;var g=JSON.parse(JSON.stringify(app.mainView.joinQueueDataObj));g.group_experimentType="live",d.push(g),f=!0}else c("not recognized experimentType:"+a);if(f){var h=null;isNaN(Number(b))||(h="eug"+b),d.forEach(function(a){a.user.id=app.mainView.user.get("_id"),a.user.username=app.mainView.user.get("username"),a.user.sessionID=app.mainView.user.get("sessionID"),a.exp_metaData.group_experimentType=a.group_experimentType,a.exp_metaData.clientCreationDate=new Date,a.exp_metaData.userUrl=app.mainView.user.url,a.exp_metaData.tag="no tag set",a.exp_metaData.description="no description set",a.exp_wantsBpuName=h}),app.userSocketClient.startJoinQueueSequence(d,e,function(b){console.log(a+" startJoinQueueSequence err:"+b),setTimeout(function(){app.mainView.userExpInfo.isSubmitting=!1},2500)})}}else c("!app.mainView.isSocketInitialized")},disableUI:function(a){app.liveJoinView.disableJoinLiveNextButton(!0,a+"+app.mainView.disableUI")},enableUI:function(a){0===app.mainView.exps.length&&app.mainView.bpus.length>0&&app.mainView.isSocketInitialized&&!app.mainView.userExpInfo.isSubmitting?app.liveJoinView.disableJoinLiveNextButton(!1,a+"+app.mainView.enableUI"):app.liveJoinView.disableJoinLiveNextButton(!0,a+"+app.mainView.disableUI")},updateJoinQueueSequence:function(a){app.liveJoinView.setJoinLiveNextButtonLabel("Live Join: Submitting Exp(s) status: "+a),app.liveJoinView.setJoinLiveNextLabel((new Date).toLocaleString()+": Submitting Exp(s) status: "+a)},updateBpuUpdate:function(){app.liveJoinView.disableJoinLiveNextButton(!1,"app.mainView.server update")},initialize:function(){app.mainView=this,app.mainView.session=new app.Session(JSON.parse(unescape($("#data-session").html()))),app.mainView.user=new app.User(JSON.parse(unescape($("#data-user").html()))),app.mainView.exps=JSON.parse(unescape($("#data-exps").html())),app.mainView.bpus=JSON.parse(unescape($("#data-bpus").html())),app.mainView.joinQueueDataObj=JSON.parse(unescape($("#data-joinQueueDataObj").html())),app.liveJoinView=new app.LiveJoinView;var a={timeoutInterval:5e3,connectionInfo:{username:app.mainView.user.get("username"),userID:app.mainView.user.id,sessionID:app.mainView.session.attributes.sessionID,socketID:null,socketHandle:null}};app.userSocketClient.setConnection(a,function(a,b){a?(app.mainView.isSocketInitialized=!1,app.liveJoinView.setJoinLiveNextLabel((new Date).toLocaleString()+":Connection Error:"+a+".  Refresh Browser.")):(app.mainView.isSocketInitialized=!0,null!==b&&void 0!==b&&(app.mainView.joinQueueDataObj=b),app.liveJoinView.setJoinLiveNextLabel((new Date).toLocaleString()+": Connected.  "+app.mainView.bpus.length+" bpus available.  "+app.mainView.exps.length+" experiments."),app.mainView.enableUI("app.mainView.initialize"))})}}),$(document).ready(function(){app.mainView=new app.MainView})}();
//# sourceMappingURL=index.min.js.map