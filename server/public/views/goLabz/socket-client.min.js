var socketHandle="/goLabz",socketStrs={setConnection:socketHandle+"/#setConnection",updateBpus:socketHandle+"/#updateBpus",submitExperimentRequest:socketHandle+"/#submitExperimentRequest",ping:socketHandle+"/#ping",activateLiveUser:socketHandle+"/#activateLiveUser",sendUserToLiveLab:socketHandle+"/#sendUserToLiveLab"},_joinLabConfirmAlertCalled=!1;!function(){"use strict";app=app||{};var a={};a.lastPing=new Date,a.lastBpuUpdate=null,a.mySocket=null,a.options=null,a.connectionInfo=null,app.userSocketClient=a,a.setConnection=function(b,c){a.options=b;var d=!1,e=setTimeout(function(){d||(d=!0,callback("timed out",null))},a.options.timeoutInterval);a.mySocket=io.connect(),a.mySocket.on("connect",function(){d||(d=!0,clearTimeout(e),a.connectionInfo=b.connectionInfo,a.connectionInfo.socketID=a.mySocket.id,a.connectionInfo.socketHandle=socketHandle,a.mySocket.on(socketStrs.ping,function(a){a&&"function"==typeof a&&a()}),console.log("conn",a.connectionInfo.sessionID),a.mySocket.emit(socketStrs.setConnection,a.connectionInfo,function(a,b){a?c(a,null):(console.log("connd",b.session.sessionID),c(null,b))}))}),a.mySocket.on("reconPing",function(b){a.mySocket.emit(socketStrs.setConnection,a.connectionInfo),b&&b(a.connectionInfo)}),a.mySocket.on(socketStrs.activateLiveUser,function(a,b){console.log("activateLiveUser",a.sessionID);var c={didConfirm:!1},d=!1,e=15e3;null!==a.doSkipConfirmation&&void 0!==a.doSkipConfirmation&&(d=a.doSkipConfirmation),null!==a.confirmTimeout&&void 0!==a.confirmTimeout&&(e=a.confirmTimeout),d?(c.didConfirm=!0,b&&b(null,c)):_joinLabConfirmAlert(e,function(a,d){c.didConfirm=d,c.err=a,b&&b(a,c)})}),a.mySocket.on(socketStrs.sendUserToLiveLab,function(a,b){console.log("sendUserToLiveLab",a.sessionID),b&&b(null),location.href="/golabzjoylab/"})},a.startUpdateBpus=function(){a.mySocket.on(socketStrs.updateBpus,function(b){a.lastBpuUpdate=new Date,app.mainView.updateFromServer(b)})},a.startJoinQueueSequence=function(b,c,d){b.forEach(function(b){b.user.socketID=a.mySocket.id}),_joinQueueSequence(app,a.mySocket,b,c,d)}}();var _joinQueueSequence=function(a,b,c,d,e){var f="_joinQueueSequence",g="1. _submitExperimentRequest";a.mainView.updateJoinQueueSequence("Submiting Experiment");var h=5e3;console.log("_joinQueueSequence",c[0].session.sessionID),_submitExperimentRequest(b,c,h,function(b){var h=c.length+" exps submitted.";null!==b&&b.length>0?(console.log(f+" end "+g+" submit err:"+b.length),h+=b.length+" errors.",b.forEach(function(a){h+=";"+a})):h+=" No errors",a.mainView.userExpInfo.isSubmitting=!1,c.length-b.length>0?d?(h+=" Wait for live join.",a.mainView.updateJoinQueueSequence(h)):(h+=" Wait for update.",a.mainView.updateJoinQueueSequence(h),e(null)):(h+=" None Passed",a.mainView.updateJoinQueueSequence(h),e(null))})},_submitExperimentRequest=function(a,b,c,d){var e=!1,f=setTimeout(function(){e||(e=!0,d("timed out in "+c,null))},c);a.emit(socketStrs.submitExperimentRequest,b,function(a,b){e||(clearTimeout(f),e=!0,d(a,b))})},_joinLabConfirmAlert=function(a,b){if(_joinLabConfirmAlertCalled)b("join lab confirm aleart already called",!1);else{_joinLabConfirmAlertCalled=!0;var c=!1,d=(setTimeout(function(){c||(c=!0,_joinLabConfirmAlertCalled=!1,b("timed out",null))},a),Math.round(a/1e3));confirm("Go To Lab."+new Date+"\n"+d+" seconds to confirm.")===!0?c||(c=!0,_joinLabConfirmAlertCalled=!1,b(null,!0)):c||(c=!0,_joinLabConfirmAlertCalled=!1,b(null,!1))}};
//# sourceMappingURL=socket-client.min.js.map