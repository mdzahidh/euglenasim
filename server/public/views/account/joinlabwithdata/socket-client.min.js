var _Handle="/account/joinlabwithdata",socketStrs={setConnection:"/#setConnection",serverError:"/#serverError",submitExperimentRequest:"/#submitExperimentRequest",activateLiveUser:"/#activateLiveUser",sendUserToLiveLab:"/#sendUserToLiveLab"},_joinLabConfirmAlertCalled=!1;!function(){"use strict";app=app||{};var a={};a.isInitialized=null,app.userSocketClient=a,a.setConnection=function(b){var c=!1;setTimeout(function(){c||(c=!0,b("timed out",null))},1e4);var d=io.connect();d.on(socketStrs.setConnection,function(a){c||(c=!0,app.mainView.session.attributes.socketID=d.id,app.mainView.session.attributes.socketHandle=_Handle,a(app.mainView.session),b(null))}),d.on(socketStrs.serverError,function(a){console.log(socketStrs.serverError,a)}),d.on("connect",function(){}),d.on(socketStrs.activateLiveUser,function(a,b,c){var d={didConfirm:!1};_joinLabConfirmAlert(b,function(a,b){d.didConfirm=b,d.err=a,c&&c(d)})}),d.on(socketStrs.sendUserToLiveLab,function(a,b){b&&b({err:null}),location.href="/account/livelab/"}),d.on("/#update",function(a){var b={};b.queueExps=[],b.liveQueueExp=null,b.textTotalRunTime=0,b.textTotalExps=0,b.bpuLiveExp=null,b.bpuLiveFinishTime=0,b.bpuTextTotalRunTime=0,b.bpuTextTotalExps=0,a.bpuExps.forEach(function(a){"live"===a.liveBpuExperiment.group_experimentType?(b.bpuLiveExp=a,b.bpuLiveFinishTime=a.liveBpuExperiment.bc_timeLeft):(b.bpuTextTotalRunTime+=a.liveBpuExperiment.bc_timeLeft,b.bpuTextTotalExps++)}),a.queueExpTags.forEach(function(a){null!==a.session.sessionID&&void 0!==a.session.sessionID&&("live"===a.group_experimentType?b.liveQueueExp=a:(b.textTotalRunTime+=a.exp_eventsRunTime+a.exp_lastResort.totalWaitTime,b.textTotalExps++))}),b.bpusPackage=[],a.groupBpus.forEach(function(a){b.bpusPackage.push(a)}),app.mainView.updateFromServer(b)}),a.submitExperimentArray=function(a,b){var c=!1;setTimeout(function(){c||(c=!0,b("timed out in",null))},5e3),a.forEach(function(a){if("live"===a.group_experimentType){var b=JSON.parse(JSON.stringify(a.zeroLedEvent)),c=JSON.parse(JSON.stringify(a.zeroLedEvent));c.time=a.liveUserLabTime,a.exp_eventsToRun.push(b),a.exp_eventsToRun.push(c)}a.session.id=app.mainView.session.get("_id"),a.session.sessionID=app.mainView.session.get("sessionID"),a.session.socketHandle=_Handle,a.session.socketID=app.mainView.session.get("socketID")}),d.emit(socketStrs.submitExperimentRequest,a,function(a,d){c||(c=!0,b(a,d))})}}}();var _joinLabConfirmAlert=function(a,b){if(_joinLabConfirmAlertCalled)b("join lab confirm aleart already called",!1);else{_joinLabConfirmAlertCalled=!0;var c=!1,d=(setTimeout(function(){c||(c=!0,_joinLabConfirmAlertCalled=!1,b("timed out",null))},a),Math.round(a/1e3));confirm("Go To Lab."+new Date+"\n"+d+" seconds to confirm.")===!0?c||(c=!0,_joinLabConfirmAlertCalled=!1,b(null,!0)):c||(c=!0,_joinLabConfirmAlertCalled=!1,b(null,!1))}};
//# sourceMappingURL=socket-client.min.js.map