!function(){"use strict";app=app||{},app.TextSubmitView=Backbone.View.extend({timeToFinishTextExperiments:0,el:"#textsubmit",template:_.template($("#tmpl-textsubmit").html()),events:{"submit form":"preventSubmit",'keypress input[type="text"]':"addNewOnEnter","click .btn-submitTextNext":"btnClick_submitTextNext"},btnClick_submitTextNext:function(a){var b=null;app.mainView.submitExperimentFromViews("text",b,function(a){a?console.log("btnClick_submitTextNext text submission err:"+a):console.log("btnClick_submitTextNext text submission okay")})},disablePrintOn:!1,disableSubmitTextNextButton:function(a,b){var c=this;c.disablePrintOn&&console.log("disableSubmitTextNextButton",a,b);var d=c.$el.find('[name="submitTextNext"]')[0];d&&(d.disabled=a)},setSubmitTextNextButtonLabel:function(a){var b=this.$el.find('[name="submitTextNext"]')[0];b&&(b.innerHTML=a)},setSubmitTextNextLabel:function(a){var b=this.$el.find('[name="browseLabel"]')[0];b&&(b.innerHTML=a)},setLoadTextLabel:function(a){var b=this.$el.find('[name="loadLabel"]')[0];b&&(b.innerHTML=a)},preventSubmit:function(a){console.log("btnClick_submitTextNext preventSubmit"),a.preventDefault()},addNewOnEnter:function(a){console.log("btnClick_submitTextNext addNewOnEnter"),13===a.keyCode&&(a.preventDefault(),this.addNew())},initialize:function(){this.model=new app.Record,this.listenTo(this.model,"change",this.render),this.render()},render:function(){var a=this;a.$el.html(a.template(a.model.attributes));var b=a.$el.find('[name="submitTextNextInput"]')[0];b.onchange=function(a){app.mainView.userExpInfo.loadTextFiles=[],app.textSubmitView.setLoadTextLabel("Loading "+a.target.files.length+" file(s)");var b=app.mainView.userExpInfo.MaxTextFileLoad-app.mainView.userExpInfo.queueTextFiles,c=app.mainView.userExpInfo.MaxTextTime-app.mainView.userExpInfo.queueTextRunTime;console.log(b,c,app.mainView.userExpInfo.MaxTextFileLoad,app.mainView.userExpInfo.queueTextFiles),_loadTextExperiments(b,c,a.target.files,function(a,b){if(a)app.textSubmitView.setLoadTextLabel("Loading Error:"+a),app.userExpInfo.loadedTextFiles=[];else{app.mainView.userExpInfo.loadedTextFiles=b.fileObjects,app.mainView.userExpInfo.loadedTextRunTime=b.totalRunTime;var c=Math.round(b.totalRunTime/1e3);app.textSubmitView.setLoadTextLabel("Loaded "+b.filesLoaded+" file(s). RunTime:"+c+" seconds.")}})}}})}();var _loadTextExperiments=function(a,b,c,d){var e=-1,f={err:null,filesLoaded:0,totalRunTime:0,fileObjects:[]},g=function(){if(e++,e<c.length&&f.filesLoaded<a&&f.totalRunTime<=b){var h={errTryCatch:null,errJson:null,errColumn:null,eventsToRun:[],metaData:null},i=c[e],j=new FileReader;j.onload=function(){try{_tryJson(j.result,function(a,b){a?(h.errJson="tryJson err:"+a,_tryColumn(j.result,function(a,b){a?b.errColumn="tryColumn err:"+a:b.metaData.runTime<1e3?b.errColumn="tryColumn err:time less than 1 second":(h.metaData=b.metaData,h.eventsToRun=b.eventsToRun,f.totalRunTime+=b.metaData.runTime,f.filesLoaded++)})):b.metaData.runTime<1e3?b.errColumn="tryJson err:time less than 1 second":(h.metaData=b.metaData,h.eventsToRun=b.eventsToRun,f.totalRunTime+=b.metaData.runTime,f.filesLoaded++)})}catch(a){h.errTryCatch=a}finally{f.fileObjects.push(h),g()}},j.readAsText(i)}else f.totalRunTimeSec=Math.round(f.totalRunTime/1e3),f.totalRunTimeMin=Math.round(f.totalRunTime/6e4),d(f.err,f)};g()},_tryJson=function(a,b){var c=null,d=null,e=null;try{var f=JSON.parse(a);if("object"==typeof f){e={metaData:{},eventsToRun:[]};var g=Object.keys(f),h=null;if(g.forEach(function(a){"metaData"===a&&(e.metaData=f.metaData),"eventsToRun"===a&&(h=f.eventsToRun)}),null!==h&&"function"==typeof h.forEach)if(0===h.length)c="try JSON LightData Err:No light data in eventsToRun";else{for(var i=null,j=0;j<h.length;j++){var k=h[j];if("number"!=typeof k.topValue||"number"!=typeof k.rightValue||"number"!=typeof k.bottomValue||"number"!=typeof k.leftValue||"number"!=typeof k.time){i="properties needed: topValue rightValue bottomValue leftValue time";break}var l={topValue:k.topValue,rightValue:k.rightValue,bottomValue:k.bottomValue,leftValue:k.leftValue,time:k.time};e.eventsToRun.push(l)}if(null===i)if(e.eventsToRun.sort(function(a,b){return a.time-b.time}),e.metaData.runTime=e.eventsToRun[e.eventsToRun.length-1].time,0===e.eventsToRun[e.eventsToRun.length-1].time)c="try JSON LightData Check Err:Zero time length";else{if(1===e.eventsToRun.length){var m={topValue:0,rightValue:0,bottomValue:0,leftValue:0,time:0};e.eventsToRun.push(m)}var n=e.eventsToRun[0].time;e.eventsToRun.forEach(function(a){a.time-=n})}else c="try JSON LightData Check Err:"+i}else c="try JSON Parse Err:eventsToRun not an object"}else c="try JSON Parse Err:jsonData not an object"}catch(o){d="catch JSON Parse Err:"+o}finally{c?b(c,null):d?b(d,null):b(null,e)}},_tryColumn=function(a,b){var c={metaData:{},eventsToRun:[]},d=null;try{a.split("\n").forEach(function(a){var b=a.search(":");if(b>-1){var d=a.substr(0,b),e=a.substr(b+1,a.length);c.metaData[d]=e}else{var f=a.split(","),g=!0;5===f.length?f.forEach(function(a){(0===a.length||""===a||isNaN(Number(a)))&&(g=!1)}):g=!1,g&&c.eventsToRun.push({time:Number(f[0]),topValue:Number(f[1]),rightValue:Number(f[2]),bottomValue:Number(f[3]),leftValue:Number(f[4])})}})}catch(e){d=e}finally{d?b(d,null):_tryJson(JSON.stringify(c),b)}};
//# sourceMappingURL=TextSubmit.min.js.map