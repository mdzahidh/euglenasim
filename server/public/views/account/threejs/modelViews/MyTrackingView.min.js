MyTrackingView=function(a,b,c){var d=a.mainView.account.attributes.modelImageSetPath,e=a.mainView.imageset;this.backgroundImage=null,this.threeBackgroundColor=16777215,this.container=b,this.isOrthographic=!0,this.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),this.renderer.setSize(this.container.clientWidth,this.container.clientHeight),this.renderer.setClearColor(this.threeBackgroundColor),this.container.appendChild(this.renderer.domElement),this.container.hoverOffset={x:12,y:-12},this.scene=new THREE.Scene,this.scene.add(new THREE.AmbientLight(16777215));var f=1,g=5e3;if(this.isOrthographic)this.camera=new THREE.OrthographicCamera(-1*this.container.clientWidth*.5,.5*this.container.clientWidth,.5*this.container.clientHeight,-1*this.container.clientHeight*.5,f,g);else{var h=gridWidth/gridHeight,i=45;this.camera=new THREE.PerspectiveCamera(i,h,f,g)}this.camera.position.x=0,this.camera.position.y=-8,this.camera.position.z=1650,this.clickMesh=new THREE.Mesh(new THREE.PlaneGeometry(this.camera.right-this.camera.left,this.camera.top-this.camera.bottom),new THREE.MeshBasicMaterial({color:this.threeBackgroundColor})),this.clickMesh.name="clickMesh",this.clickMesh.visible=!0,this.clickMesh.position=new THREE.Vector3(0,0,0),this.scene.add(this.clickMesh),this.wasSliderCreated=!1,this.touchHelper={point:new THREE.Vector3(0,0,0),raycaster:new THREE.Raycaster,projector:new THREE.Projector};var j={x:20,y:5,z:5},k={x:0,y:0,z:10},l={x:0,y:0,z:.1},m={surge:30,roll:4,pitch:1,yaw:1};return a.editorView&&(j={x:a.editorView.model.get("length"),y:a.editorView.model.get("diameter"),z:a.editorView.model.get("diameter")},k={x:a.editorView.model.get("x"),y:a.editorView.model.get("y"),z:10},l={x:0,y:0,z:a.editorView.model.get("zRot")},m={surge:a.editorView.model.get("surge")[0],roll:a.editorView.model.get("roll")[0],pitch:a.editorView.model.get("pitch")[0],yaw:a.editorView.model.get("pitch")[0]}),this.euglena=new Euglena(j,k,l,m,this.inertialAxes),this.scene.add(this.euglena),this.imageSetsPath=d,this.imageset=e,this.resetData(),this.initialPlay=!1,this.doStopPlay=!1,this.doReset=!0,this.startPlay=!1,this.runData=[],this.addEugPointsTimer=0,this.frameCounter=0,this.eugUpdateCnt=0,this.eugUpdateInt=50,setTimeout(function(){c()},200),this},MyTrackingView.prototype=Object.create(Object.prototype),MyTrackingView.prototype.setEuglenaParameters=function(){var a={x:20,y:5,z:5},b={x:0,y:0,z:10},c={x:0,y:0,z:.1},d={surge:30,roll:4,pitch:1,yaw:1},e=1;app.editorView&&(a={x:app.editorView.model.get("length"),y:app.editorView.model.get("diameter"),z:app.editorView.model.get("diameter")},b={x:app.editorView.model.get("x"),y:app.editorView.model.get("y"),z:10},c={x:0,y:0,z:app.editorView.model.get("zRot")},d={surge:app.editorView.model.get("surge")[0],roll:app.editorView.model.get("roll")[0],pitch:app.editorView.model.get("pitch")[0],yaw:app.editorView.model.get("yaw")[0],coupling:app.editorView.model.get("coupling")},e=app.editorView.model.get("modelCase")),this.euglena.setSize(a.x,a.y,a.z),this.euglena.setPosition(b.x,b.y,100),this.euglena.setRotation(0,0,c.z),this.euglena.setDynamics(d.surge,d.roll,d.pitch,d.yaw,d.coupling,e)},MyTrackingView.prototype.resetData=function(){var a=this.imageSetsPath,b=this.imageset,c=document.getElementById("MainHeader").innerHTML;c="Images from "+b.attributes.displayName,document.getElementById("MainHeader").innerHTML=c;var d=b.attributes.activeImage.frameNumber,e={name:"microscopeView",size:{width:640,height:480},background:{color:13882323,opacity:1},image:{hasImage:!0,basePath:a,activeImage:b.attributes.activeImage,images:b.attributes.images,lightData:b.attributes.lightData},light:{hasLight:!0,lightSize:30,allOn:!1},grid:{hasGrid:!0,boxSize:14,isVisible:!0}};this.micView?(this.micView.resetData(e),this.currentImageFrame=d):(this.micView=new MicroscopeView(e),this.micView.position.y=this.container.offsetTop,this.scene.add(this.micView),this.currentImageFrame=d,this.addStaticPath(app.mainView.setpath.attributes.pathName,app.mainView.setpath.attributes.points)),this.setEuglenaParameters(),this.setImageFrame(d,"view resetData"),this.hasUpdate=!1,this.isUpdateControlClick=!1,this.controlClick="",this.updateObject={state:"viewing"},this.currentTime=0,this.state=0,this.doStopPlay=!1,this.doReset=!0,this.startPlay=!1,this.runData=[],this.eugUpdateCnt=0,this.eugUpdateInt=50,this.removePath(),this.createNewSetPath("run");({name:"MyTrackingView:"+app.mainView.serverTab+":resetData",time:(new Date).getTime(),imageSetsPath:a,imagesetId:b._id,currentImageFrame:this.currentImageFrame})},MyTrackingView.prototype.animate=function(a){var b=this.container.clientWidth,c=this.container.clientHeight;if(this.initialPlay)this.initialPlay=this.micView.updateForPlaying(a,this.doStopPlay),this.initialPlay||this.resetData();else if(this.startPlay){var d=this.micView.updateForPlaying(a,this.doStopPlay);this.startPlay=d.isStillPlaying,this.eugUpdateCnt+=a;var e={};this.eugUpdateCnt>=this.eugUpdateInt&&(this.eugUpdateCnt=0,e=this.euglena.update(this.micView.lightValues.left,this.micView.lightValues.right,this.micView.lightValues.top,this.micView.lightValues.bottom)),e.lights=this.micView.lightValues;var f=new THREE.Vector3;f.setFromMatrixPosition(this.euglena.matrixWorld),e.eugPosition=f,this.runData.push(e),d.didChangeImage&&this.addPointToPath({x:f.x,y:f.y},d.playImageFrame),this.startPlay||app.mainView.updateFromViewCallback(this.runData)}this.isOrthographic||(this.camera.aspect=b/c),this.camera.updateProjectionMatrix(),this.renderer.setViewport(0,0,b,c),this.renderer.setScissor(0,0,b,c),this.renderer.enableScissorTest(!0),this.renderer.setClearColor(this.threeBackgroundColor),this.renderer.render(this.scene,this.camera)},MyTrackingView.prototype.setImageFrame=function(a,b){var c=(this.micView.updateForImageChange(a),Number(this.micView.currentImageTime)/1e3);document.getElementById("txtboxFrame").value="Frame: "+a,document.getElementById("txtboxTime").value="Time: "+c+" seconds"},MyTrackingView.prototype.getImageFrame=function(){return this.micView.currentImageFrame},MyTrackingView.prototype.getImageTime=function(){return this.micView.currentImageTime},MyTrackingView.prototype.createNewSetPath=function(a){this.micView.createNewSetPath({name:a,index:0,type:"x",size:6,color:1,highlightColor:1,points:[],id:(new Date).getTime()})},MyTrackingView.prototype.removePointFromPath=function(){this.micView.removePointFromPath(this.micView.currentImageFrame)},MyTrackingView.prototype.addPointToPath=function(a,b){this.micView.addPointToPath(a,b)},MyTrackingView.prototype.removePath=function(){this.micView.clearNewPath()},MyTrackingView.prototype.addPath=function(a,b){this.removePath(),this.micView.createNewSetPath({name:a,index:0,type:"x",size:6,color:0,highlightColor:0,points:[],id:(new Date).getTime()});var c=this;b.forEach(function(a){c.addPointToPath({x:a.x,y:a.y},a.frameNumber)})},MyTrackingView.prototype.addStaticPath=function(a,b){this.micView.createNewStaticPath({name:a,index:0,type:"b",size:6,color:0,highlightColor:0,points:b,id:(new Date).getTime()})},MyTrackingView.prototype.addMouseMoveEvent=function(){var a=this;a.micView&&a.container.addEventListener("mousemove",function(b){b.preventDefault();var c=a.threePointForTouchEvent({x:b.layerX,y:b.layerY-a.container.offsetTop},a.clickMesh);c&&a.micView.setMousePoint(c)},!1)},MyTrackingView.prototype.addMouseOutEvent=function(){var a=this;a.micView&&a.container.addEventListener("mouseout",function(a){a.preventDefault()},!1)},MyTrackingView.prototype.toggleClickOn=!1,MyTrackingView.prototype.toggleClickEvent=function(a){function b(a){var b=c.threePointForTouchEvent({x:a.layerX,y:a.layerY-c.container.offsetTop},c.clickMesh);if(b)if(c.initialPlay||c.startPlay)c.doStopPlay=!0,c.doReset=!0;else if(app.editorView&&"newpath"==app.editorView.state||"editpath"==app.editorView.state){c.addPointToPath(b,c.micView.currentImageFrame);var d=c.micView.currentImageFrame,e=c.micView.currentImageTime,f=Math.round(1e3*b.x)/1e3,g=Math.round(1e3*b.y)/1e3,h=d+":("+f+", "+g+")";app.editorView.addPointToNewPath({displayName:h,frameNumber:d,frameTime:e,filename:c.micView.currentImage.filename,timestamp:c.micView.currentImage.timestamp,x:f,y:g})}a.preventDefault()}var c=this;c.toggleClickOn=a,a?c.container.onclick=b:c.container.onclick=null},MyTrackingView.prototype.toggleDownOn=!1,MyTrackingView.prototype.toggleDownEvent=function(a){function b(a){if(c.toggleDownOn){var b=c.threePointForTouchEvent({x:a.layerX,y:a.layerY-c.container.offsetTop},c.ruler.circleMesh);if(null!==b&&c.ruler.imageMesh.visible)c.isClickHoldingRulerRot||(c.isClickHoldingRulerRot=!0,c.touchHelper.mouse2D=b);else{var d=c.threePointForTouchEvent({x:a.layerX,y:a.layerY-c.container.offsetTop},c.ruler.imageMesh);null!==d&&c.ruler.imageMesh.visible?c.isClickHoldingRuler||(c.isClickHoldingRuler=!0,c.touchHelper.mouse2D=d):c.controls.buttons.forEach(function(b){var d=c.controls[b];if(d.button.imageMesh.visible){var e=c.threePointForTouchEvent({x:a.layerX,y:a.layerY-c.container.offsetTop},d.button.imageMesh);null!==e&&d.button.resizeForDown()}})}}}var c=this,d="mousedown";c.toggleDownOn=a,a?c.container.addEventListener(d,b):c.container.removeEventListener(d,b)},MyTrackingView.prototype.toggleUpOn=!1,MyTrackingView.prototype.toggleUpEvent=function(a){function b(a){if(c.toggleUpOn){var b=c.threePointForTouchEvent({x:a.layerX,y:a.layerY-c.container.offsetTop},c.ruler.circleMesh);if(null!==b)c.isClickHoldingRulerRot&&(c.isClickHoldingRulerRot=!1,c.isClickHoldingRuler=!1);else{c.isClickHoldingRulerRot=!1;var d=c.threePointForTouchEvent({x:a.layerX,y:a.layerY-c.container.offsetTop},c.ruler.imageMesh);null!==d?c.isClickHoldingRuler&&(c.isClickHoldingRulerRot=!1,c.isClickHoldingRuler=!1):c.controls.buttons.forEach(function(b){var d=c.controls[b];if(d.button.buttonState===d.button.buttonStates.down){var e=c.threePointForTouchEvent({x:a.layerX,y:a.layerY-c.container.offsetTop},d.button.imageMesh);null!==e&&(d.button.resizeForUp(),c.hasUpdate=!0,c.isUpdateControlClick=!0,c.controlClick=b)}})}}}var c=this,d="mouseup";c.toggleUpOn=a,a?c.container.addEventListener(d,b):c.container.removeEventListener(d,b)},MyTrackingView.prototype.toggleOutOn=!1,MyTrackingView.prototype.toggleOutEvent=function(a){function b(a){c.toggleOutOn&&(c.isClickHoldingRulerRot=!1,c.isClickHoldingRuler=!1,c.touchHelper.mouse2D=null,c.controls.buttons.forEach(function(a){var b=c.controls[a];b.button&&b.button.imageMesh.visible&&b.button.resizeForUp()}))}var c=this,d="mouseout";c.toggleOutOn=a,a?c.container.addEventListener(d,b):c.container.removeEventListener(d,b)},MyTrackingView.prototype.threePointForTouchEvent=function(a,b){return this.touchHelper.point.x=a.x/this.container.clientWidth*2-1,this.touchHelper.point.y=2*-(a.y/this.container.clientHeight)+1,this.touchHelper.point.z=0,this.touchHelper.raycaster=this.touchHelper.projector.pickingRay(this.touchHelper.point,this.camera),this.touchHelper.intersector=this.touchHelper.raycaster.intersectObject(b),this.touchHelper.intersector.length>0?{x:this.touchHelper.intersector[0].point.x,y:this.touchHelper.intersector[0].point.y,z:2}:null};
//# sourceMappingURL=MyTrackingView.min.js.map