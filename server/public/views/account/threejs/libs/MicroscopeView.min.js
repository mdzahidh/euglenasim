MicroscopeView=function(a){THREE.Mesh.call(this),this.loadedImages={};var b=[8263654,8547225,7051639,15013655,5060150,7028121,1022258,15132390,10042685,0,3546957,544025,10066329,10054507],c=[15013655,5060150,10066329,7051639,3546957,10042685,0,1022258,8263654,8547225,10054507,15132390,544025,7028121];this.PathColors=[];for(var d=0;d<b.length;d++)this.PathColors.push({normal:b[d],highlight:c[d]});this.name=a.name,this.width=a.size.width,this.height=a.size.height;var e={name:"mouseHover",index:-1,type:"x",size:10,color:16777215,highlightColor:16777215,doHighlight:!1,point:{x:0,y:0,z:2}};if(this.mouseHover=new MyPoint(e),this.mouseHover.name=e.name,this.mouseHoverSize=0,this.mouseHover.toggleVisible(!0),this.add(this.mouseHover),this.material=new THREE.MeshBasicMaterial({color:a.background.color,opacity:a.background.opacity,transparent:!0}),this.geometry=new THREE.PlaneGeometry(a.size.width,a.size.height),this.position=new THREE.Vector3(0,0,0),this.hasLights=!1,this.light=null,null!==a.light&&void 0!==a.light&&a.light.hasLight){this.hasLights=!0,null!==a.light.lightSize&&void 0!==a.light.lightSize||(a.light.lightSize=10);var f={name:"squareLights",isTransparent:!0,initOpacity:1,initColor:16773120,parentSize:{width:this.width,height:this.height},lightSize:{width:a.light.lightSize,height:a.light.lightSize},offsets:{x:1,y:1,z:1}};this.lights=new MyQuadLightsMesh(f),this.lights.debugOn(a.light.allOn),this.add(this.lights)}if(this.hasGridLines=!1,this.gridLines=null,null!==a.grid&&void 0!==a.grid&&a.grid.hasGrid){this.hasGridLines=!0,this.boxSize=a.grid.boxSize;for(var g=new THREE.Geometry,h=this.position.x-.5*a.size.width,i=this.position.y-.5*a.size.height,j=a.size.width/this.boxSize,k=0;j>=k;k++)g.vertices.push(new THREE.Vector3(h+this.boxSize*k,0,i)),g.vertices.push(new THREE.Vector3(h+this.boxSize*k,0,i+a.size.height));for(var l=a.size.height/this.boxSize,k=0;l>=k;k++)g.vertices.push(new THREE.Vector3(h,0,i+this.boxSize*k)),g.vertices.push(new THREE.Vector3(h+a.size.width,0,i+this.boxSize*k));var m=new THREE.LineBasicMaterial({color:16711680,opacity:.2,transparent:!0});this.gridLines=new THREE.Line(g,m),this.gridLines.type=THREE.LinePieces,this.gridLines.visible=a.grid.isVisible,this.gridLines.rotation.x=.5*Math.PI,this.gridLines.position.z=5,this.add(this.gridLines)}this.playImageLightData=[],this.playImageFrame=0,this.playImageTime=0,this.playtime=0,this.properties=a,this.resetData(a),this.lightValues={led1:0,led2:0,led3:0,led4:0},this.newPath=null,this.staticPath=null,this.imageCounter=0},MicroscopeView.prototype=Object.create(THREE.Mesh.prototype),MicroscopeView.prototype.resetData=function(a){if(this.loadedImages={},this.properties=a,this.hasImage=!1,this.imageLightData=[],this.currentImage=null,this.currentImageFrame=0,this.currentImageTime=0,this.playData={},null!==a.image&&void 0!==a.image&&a.image.hasImage){this.hasImage=!0,a.image.activeImage&&a.image.activeImage.frameNumber&&(this.currentImage=a.image.activeImage,this.currentImageFrame=this.currentImage.frameNumber,this.currentImageTime=this.currentImage.frameTime),a.image.images.sort(function(a,b){return a.timestamp-b.timestamp}),a.image.images.forEach(function(a){a.isImage=!0}),a.image.lightData.sort(function(a,b){return a.timestamp-b.timestamp}),a.image.lightData.forEach(function(a){a.isImage=!1}),this.imageLightData=a.image.images,this.imageLightData.forEach(function(a){a.isImage=!0}),this.imageLightData=this.imageLightData.concat(a.image.lightData),this.imageLightData.sort(function(a,b){return a.timestamp-b.timestamp});for(var b=a.image.lightData,c=0;c<a.image.images.length;c++){var d=a.image.images[c];if(b[0].timestamp>d.timestamp)d.lightData=[0,0,0,0];else{for(var e=b[0],f=0;f<b.length;f++){var g=b[f].timestamp-d.timestamp;if(g>0){d.lightData=[e.led1,e.led2,e.led3,e.led4];break}e=b[f]}void 0!==d.lightData&&void 0!==d.lightData||(d.lightData=[0,0,0,0])}}this.setLightData(0,0,0,0)}this.playImageLightData=this.imageLightData.slice(0),this.playImageLightData.sort(function(a,b){return a.timestamp-b.timestamp}),this.playtime=this.playImageLightData[0].frameTime},MicroscopeView.prototype.updateForPlaying=function(a,b){this.playtime+=a;var c=!1;if(this.playImageLightData.length>0&&!b){if(this.playtime>=this.playImageLightData[0].frameTime){var d=this.playImageLightData.shift();if(d.isImage){this.imageCounter++,this.imageCounter>=5&&(this.imageCounter=0,c=!0),this.playImageFrame=d.frameNumber,this.playImageTime=d.frameTime,this.loadNewImage(d.path,d.timestamp,"updateForPlaying"),this.newPath&&this.newPath.setHighlightPoint(d.frameNumber);var e=Number(d.frameTime)/1e3;document.getElementById("txtboxFrame").value="Frame: "+d.frameNumber,document.getElementById("txtboxTime").value="Time: "+e+" seconds"}else this.setLightData(d.led1,d.led2,d.led3,d.led4)}return{isStillPlaying:!0,didChangeImage:c,playImageFrame:this.playImageFrame,playImageTime:this.playImageTime}}return{isStillPlaying:!1,didChangeImage:c}},MicroscopeView.prototype.setLightData=function(a,b,c,d){this.lightValues={led1:a,led2:b,led3:c,led4:d,top:a,right:b,bottom:c,left:d},this.lights.setOpacity(a,b,c,d)},MicroscopeView.prototype.updateForImageChange=function(a){var b=this;b.currentImage=null;for(var c=0;c<b.properties.image.images.length;c++)if(Number(b.properties.image.images[c].frameNumber)===Number(a)){b.currentImage=b.properties.image.images[c];break}if(b.currentImage){b.properties.image.lightData[a];b.currentImageFrame=b.currentImage.frameNumber,b.currentImageTime=b.currentImage.frameTime,b.setLightData(b.currentImage.lightData[0],b.currentImage.lightData[1],b.currentImage.lightData[2],b.currentImage.lightData[3]),b.loadNewImage(b.currentImage.path,b.currentImage.timestamp,"updateForImageChange"),b.newPath&&b.newPath.setHighlightPoint(b.currentImageFrame)}},MicroscopeView.prototype.loadNewImage=function(a,b,c){var d=this;if(d.loadedImages[b])d.backgroundImage&&d.remove(d.backgroundImage),d.backgroundImage=d.loadedImages[b],d.add(d.backgroundImage);else{var e=function(c){d.backgroundImage&&d.remove(d.backgroundImage);var e=new THREE.MeshBasicMaterial({color:16777215,map:g});d.backgroundImage=new Mesh_Image(a,g,e,!1,d.width,d.height,""),d.loadedImages[b]=d.backgroundImage,d.add(d.backgroundImage)},f=function(a){console.log("loadImage ERROR: ",a)},g=THREE.ImageUtils.loadTexture(a,THREE.UVMapping,e,f);g.minFilter=g.magFilter=THREE.LinearFilter}},MicroscopeView.prototype.createNewStaticPath=function(a){var b=this;a.color=b.PathColors[a.color].normal,a.highlightColor=b.PathColors[a.highlightColor].highlight,this.staticPath=new MyPath(a),this.staticPath.toggleHighlight(!1),a.points.forEach(function(a){b.addPointToStaticPath({x:a.x,y:a.y},a.frameNumber)})},MicroscopeView.prototype.addPointToStaticPath=function(a,b){for(var c=0;c<this.staticPath.points.length;c++){var d=this.staticPath.points[c];if(console.log(d),d.frameNumber==b){this.staticPath.points.splice(c,1),this.remove(d);break}}var e=this.staticPath.addPoint(a);e.frameNumber=b,this.add(e)},MicroscopeView.prototype.createNewSetPath=function(a){var b=this;a.color=b.PathColors[a.color].normal,a.highlightColor=b.PathColors[a.highlightColor].highlight,this.newPath=new MyPath(a),this.newPath.toggleHighlight(!1)},MicroscopeView.prototype.removePointFromPath=function(a){for(var b=0;b<this.newPath.points.length;b++){var c=this.newPath.points[b];if(c.frameNumber==a){this.newPath.points.splice(b,1),this.remove(c);break}}},MicroscopeView.prototype.addPointToPath=function(a,b){for(var c=0;c<this.newPath.points.length;c++){var d=this.newPath.points[c];if(d.frameNumber==b){this.newPath.points.splice(c,1),this.remove(d);break}}var e=this.newPath.addPoint(a);e.frameNumber=b,this.add(e)},MicroscopeView.prototype.setHighlightPoint=function(a){null!==this.newPath&&void 0!==this.newPath},MicroscopeView.prototype.clearNewPath=function(){if(null!==this.newPath&&void 0!==this.newPath){for(var a=0;a<this.newPath.points.length;a++){var b=this.newPath.points[a];this.remove(b)}this.newPath=null}},MicroscopeView.prototype.getNewPathPoints=function(){for(var a=[],b=0;b<this.newPath.points.length;b++){var c={x:this.newPath.points[b].position.x,y:this.newPath.points[b].position.y,frameNumber:this.newPath.points[b].frameNumber};a.push(c)}return a},MicroscopeView.prototype.clearMousePoint=function(){this.mouseHover.toggleVisible(!1)},MicroscopeView.prototype.setMousePoint=function(a){this.mouseHover.toggleVisible(!0),null!==this.mouseHover&&void 0!==this.mouseHover&&this.mouseHover.setPosition({x:a.x+this.mouseHoverSize,y:a.y+this.mouseHoverSize,z:this.mouseHover.position.z})};
//# sourceMappingURL=MicroscopeView.min.js.map