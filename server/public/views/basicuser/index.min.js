!function(){"use strict";app=app||{},app.User=Backbone.Model.extend({idAttribute:"_id",url:"/basicuser/"}),app.Session=Backbone.Model.extend({idAttribute:"_id",url:"/basicuser/"}),app.Record=Backbone.Model.extend({idAttribute:"_id",defaults:{_id:void 0,username:"",email:"",isActive:"",textExpFilename:"",mServerFileLocations:{myServerMediaLocation:""}},urlDownload:function(){return"/basicuser/download/"+(this.isNew()?"":this.id+"/")},url:function(){return"/basicuser/"+(this.isNew()?"":this.id+"/")}}),app.RecordCollection=Backbone.Collection.extend({model:app.Record,url:"/basicuser/",parse:function(a){return app.pagingView.model.set({pages:a.pages,items:a.items}),app.filterView.model.set(a.filters),a.data}}),app.Filter=Backbone.Model.extend({defaults:{username:"",roles:"",isActive:"",sort:"",limit:""}}),app.Paging=Backbone.Model.extend({defaults:{pages:{},items:{}}}),app.ResultsView=Backbone.View.extend({el:"#results-table",template:_.template($("#tmpl-results-table").html()),initialize:function(){this.collection=new app.RecordCollection(app.mainView.results.data),this.listenTo(this.collection,"reset",this.render),this.render()},render:function(){this.$el.html(this.template());var a=document.createDocumentFragment();this.collection.each(function(b){var c=new app.ResultsRowView({model:b});a.appendChild(c.render().el)},this),$("#results-rows").append(a),0===this.collection.length&&$("#results-rows").append($("#tmpl-results-empty-row").html())}}),app.ResultsRowView=Backbone.View.extend({tagName:"tr",template:_.template($("#tmpl-results-row").html()),events:{"click .btn-details":"viewDetails","click .btn-download-tar":"downloadTar"},downloadTar:function(){location.href=this.model.urlDownload()},viewDetails:function(){location.href=this.model.url()},render:function(){if(null!==this.model.attributes.exp_submissionTime){var a=new Date(this.model.attributes.exp_submissionTime);this.model.attributes.exp_submissionTime=a.toString()}return this.$el.html(this.template(this.model.attributes)),this}}),app.FilterView=Backbone.View.extend({el:"#filters",template:_.template($("#tmpl-filters").html()),events:{"submit form":"preventSubmit",'keypress input[type="text"]':"filterOnEnter","change select":"filter"},initialize:function(){this.model=new app.Filter(app.mainView.results.filters),this.listenTo(this.model,"change",this.render),this.render()},render:function(){this.$el.html(this.template(this.model.attributes));for(var a in this.model.attributes)this.model.attributes.hasOwnProperty(a)&&this.$el.find('[name="'+a+'"]').val(this.model.attributes[a])},preventSubmit:function(a){a.preventDefault()},filterOnEnter:function(a){13===a.keyCode&&this.filter()},filter:function(){var a=$("#filters form").serialize();Backbone.history.navigate("q/"+a,{trigger:!0})}}),app.PagingView=Backbone.View.extend({el:"#results-paging",template:_.template($("#tmpl-results-paging").html()),events:{"click .btn-page":"goToPage"},initialize:function(){this.model=new app.Paging({pages:app.mainView.results.pages,items:app.mainView.results.items}),this.listenTo(this.model,"change",this.render),this.render()},render:function(){this.model.get("pages").total>1?(this.$el.html(this.template(this.model.attributes)),this.model.get("pages").hasPrev||this.$el.find(".btn-prev").attr("disabled","disabled"),this.model.get("pages").hasNext||this.$el.find(".btn-next").attr("disabled","disabled")):this.$el.empty()},goToPage:function(a){var b=$("#filters form").serialize()+"&page="+$(a.target).data("page");Backbone.history.navigate("q/"+b,{trigger:!0}),$("body").scrollTop(0)}}),app.Router=Backbone.Router.extend({routes:{"":"default","q/:params":"query"},initialize:function(){app.mainView=new app.MainView},"default":function(){app.firstLoad||app.resultsView.collection.fetch({reset:!0}),app.firstLoad=!1},query:function(a){app.resultsView.collection.fetch({data:a,reset:!0}),app.firstLoad=!1}}),app.MainView=Backbone.View.extend({el:".page .container",didPassCanceling:!1,hasAcceptedLiveExp:!1,lastBpuUpdateObj:null,wasUpdateUIsCalled:!1,bpuIndicies:[],roundMsToMins:function(a){return Math.floor(a/6e4)},roundMsToSeconds:function(a){return Math.round(a/1e3)},userExpInfo:{isSubmitting:!1,MaxTextFileLoad:10,MaxTextTime:6e5,loadedTextRunTime:0,loadedTextFiles:[],queueTextRunTime:0,queueTextFiles:0},submitExperimentFromViews:function(a,b){if(app.mainView.disableUI("app.mainView.submitExperimentFromViews"),console.log("1. submitExperimentFromViews","true?:"+app.userSocketClient.isInitialized,"false?:"+app.mainView.userExpInfo.isSubmitting),app.userSocketClient.isInitialized&&!app.mainView.userExpInfo.isSubmitting){app.mainView.userExpInfo.isSubmitting=!0;var c=[],d=!1,e=!1;if("live"===a){d=!0;var f=JSON.parse(JSON.stringify(app.mainView.joinQueueDataObj));f.group_experimentType="live",f.user.groups=app.mainView.session.attributes.user.groups,console.log(f),console.log(app.mainView.session),c.push(f),e=!0}else"text"===a&&(app.mainView.userExpInfo.loadedTextFiles.forEach(function(a){var b=JSON.parse(JSON.stringify(app.mainView.joinQueueDataObj));b.group_experimentType="text",b.exp_eventsToRun=a.eventsToRun,b.exp_metaData=a.metaData,c.push(b)}),c.length>0&&(e=!0));e&&(c.forEach(function(a){a.user.id=app.mainView.user.get("_id"),a.user.name=app.mainView.user.get("username"),a.user.groups=app.mainView.user.get("groups"),a.session.id=app.mainView.session.get("id"),a.session.sessionID=app.mainView.session.get("sessionID"),a.session.socketID=app.mainView.session.get("socketID"),a.exp_metaData.group_experimentType=a.group_experimentType,a.exp_wantsBpuName=b,a.exp_metaData.clientCreationDate=new Date,a.exp_metaData.userUrl=app.mainView.user.url,a.exp_metaData.tag="no tag set",a.exp_metaData.description="no description set"}),console.log("2. submitExperimentFromViews","submittingToSocketClient"),app.userSocketClient.submitExperimentArray(c,function(a,b){if(console.log("3. submitExperimentFromViews","submittingToSocketClient replied"),a)console.log("4e1. submitExperimentFromViews","submittingToSocketClient replied with err:"+a),setTimeout(function(){console.log("5. reset. submitExperimentFromViews","app.mainView.userExpInfo.isSubmitting is now false again"),app.mainView.userExpInfo.isSubmitting=!1},2500);else if(b&&b.forEach){console.log("4. submitExperimentFromViews","submittingToSocketClient replied with validationObjs:"+b.length);var c=0;b.forEach(function(a){c++,console.log("4-"+c+". submitExperimentFromViews",a.group_experimentType,a.exp_wantsBpuName,a.exp_eventsRunTime,a.isValid)}),setTimeout(function(){console.log("5. reset. submitExperimentFromViews","app.mainView.userExpInfo.isSubmitting is now false again"),app.mainView.userExpInfo.isSubmitting=!1},2500)}else console.log("4e2. submitExperimentFromViews","submittingToSocketClient replied with validationObjs:dne"),setTimeout(function(){console.log("5. reset. submitExperimentFromViews","app.mainView.userExpInfo.isSubmitting is now false again"),app.mainView.userExpInfo.isSubmitting=!1},2500)}))}},disableUI:function(a){app.liveJoinView.disableJoinLiveNextButton(!0,a+"+app.mainView.disableUI"),app.textSubmitView&&app.textSubmitView.disableSubmitTextNextButton(!0,a+"+app.mainView.disableUI"),app.bpuImageView&&app.bpuImageView.disableAll(!0,a+"+app.mainView.disableUI")},updateJoinQueueSequence:function(a){app.liveJoinView.setJoinLiveNextLabel((new Date).toLocaleString()+": Submitting Exp(s) status: "+a),app.textSubmitView&&app.textSubmitView.setSubmitTextNextLabel("Text Submit: Submitting Exp(s) status: "+a)},updateFromServer:function(a){app.mainView.setHeaderLabel("Updated:"+new Date);if(a.bpusPackage&&a.bpusPackage.forEach&&a.bpusPackage.length>0?a.bpusPackage.forEach(function(a){if(a.liveBpuExperiment){app.bpuImageView&&app.bpuImageView.setTitleLabel(a.index,a.name+", User:"+a.liveBpuExperiment.username);var b=Math.round(a.liveBpuExperiment.bc_timeLeft/1e3);app.bpuImageView&&app.bpuImageView.setUserLabel(a.index,"Time Left:"+b+" seconds"),app.bpuImageView&&app.bpuImageView.setStatusLabel(a.index,"Status:"+a.bpuStatus)}else app.bpuImageView&&app.bpuImageView.setTitleLabel(a.index,a.name+", User:None"),app.bpuImageView&&app.bpuImageView.setUserLabel(a.index,"Time Left:0 seconds"),app.bpuImageView&&app.bpuImageView.setStatusLabel(a.index,"Status:"+a.bpuStatus)}):app.mainView.bpus.forEach(function(a){app.bpuImageView&&app.bpuImageView.setTitleLabel(a.index,"eug"+a.index+", User:None"),app.bpuImageView&&app.bpuImageView.setUserLabel(a.index,"Time Left:0 seconds"),app.bpuImageView&&app.bpuImageView.setStatusLabel(a.index,"Status:Unknown")}),!app.mainView.userExpInfo.isSubmitting){var b=!1,c="No live experiments in queue or any BPU.  Click To Join.";if(null!==a.bpuLiveExp&&void 0!==a.bpuLiveExp){var d=Math.round(a.bpuLiveFinishTime/1e3);c="On BPU "+a.bpuLiveExp.name+".  ",0>d?(d=-1*d,c+="Processing for "+d+" seconds."):c+="Wait time is "+d+" seconds.",b=!0}else if(null!==a.liveQueueExp&&void 0!==a.liveQueueExp){var e=Math.round(a.liveQueueExp.exp_lastResort.totalWaitTime/1e3);c="Waiting for bpu "+a.liveQueueExp.exp_lastResort.bpuName+".  ",c+="Wait time is "+e+" seconds.",b=!0}app.liveJoinView.setJoinLiveNextLabel(c);var f=!1,g="",h=0;if(a.bpuTextTotalExps>0&&(h=a.bpuTextTotalRunTime,g+=a.bpuTextTotalExps+" exps on BPUs.  "),a.textTotalExps>0&&(h+=a.textTotalRunTime,g+=a.textTotalExps+" exps in queue.  "),""===g)g="No text experiments in queue.  Click To Join.";else{var i=Math.round(h/1e3);g+="Wait time is "+i+" seconds."}app.textSubmitView&&app.textSubmitView.setSubmitTextNextLabel(g),app.mainView.userExpInfo.queueTextFiles=a.bpuTextTotalExps+a.textTotalExps,app.mainView.userExpInfo.queueTextRunTime=h,app.mainView.userExpInfo.queueTextFiles>=app.mainView.userExpInfo.MaxTextFileLoad?f=!0:app.mainView.userExpInfo.queueTextRunTime>=app.mainView.userExpInfo.MaxTextTime?f=!0:0===app.mainView.userExpInfo.loadedTextFiles.length&&(f=!0),0===app.mainView.bpus.length&&(b=!1,f=!1),app.liveJoinView.disableJoinLiveNextButton(b,"app.mainView.server update"),app.textSubmitView&&app.textSubmitView.disableSubmitTextNextButton(f,"app.mainView.server update"),app.mainView.bpus.forEach(function(a){app.bpuImageView&&app.bpuImageView.disableLiveButton(a.index,b,"app.mainView.server update"),app.bpuImageView&&app.bpuImageView.disableTextButton(a.index,f,"app.mainView.server update")})}},setHeaderLabel:function(a){var b=app.mainView.$el.find('[name="headerLabel"]')[0];b&&(b.innerHTML=a)},initialize:function(){app.mainView=this,console.log("initialize"),app.mainView.hasResults=!1,app.mainView.notOnlyLive=!1,app.mainView.user=new app.User(JSON.parse(unescape($("#data-user").html()))),app.mainView.session=new app.Session(JSON.parse(unescape($("#data-session").html()))),app.mainView.joinQueueDataObj=JSON.parse(unescape($("#data-joinQueueDataObj").html())),app.mainView.bpus=JSON.parse(unescape($("#data-bpus").html())),app.liveJoinView=new app.LiveJoinView,app.mainView.hasResults&&(app.resultsView=new app.ResultsView,app.filterView=new app.FilterView,app.pagingView=new app.PagingView),app.userSocketClient.setConnection(function(a){a?(app.userSocketClient.isInitialized=!1,app.liveJoinView.setJoinLiveNextLabel("Connection Error:"+a+".  Refresh Browser.")):(app.userSocketClient.isInitialized=!0,app.mainView.setHeaderLabel("Connected. Wait for BPU Update."))})}}),$(document).ready(function(){app.firstLoad=!0,app.router=new app.Router,Backbone.history.start()})}();
//# sourceMappingURL=index.min.js.map